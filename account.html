<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Account | LUMOS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gray-50 text-gray-800 font-sans pb-24">


    <header class="bg-white p-4 shadow-sm flex items-center gap-4 md:hidden sticky top-0 z-50">
        <a href="index.html"><i data-lucide="arrow-left" class="w-6 h-6"></i></a>
        <h1 class="text-lg font-bold">My Account</h1>
    </header>

    <header class="hidden md:block bg-white border-b py-4 mb-8">
        <div class="max-w-4xl mx-auto px-6 flex justify-between items-center">
            <a href="index.html" class="text-2xl font-serif font-bold">LUMOS.</a>
            <button onclick="auth.logout()" class="text-sm text-red-500 font-bold hover:underline">LOGOUT</button>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 md:px-6 mt-6">
        
        <div class="bg-white rounded-xl p-6 shadow-sm mb-6 flex flex-col md:flex-row items-center gap-6">
        
        <div class="relative group">
            <img id="profile-img-display" src="https://via.placeholder.com/150" class="w-28 h-28 rounded-full object-cover border-4 border-gray-50 shadow-md">
            
            <label for="file-upload" class="hidden md:flex absolute inset-0 items-center justify-center bg-black/40 rounded-full cursor-pointer opacity-0 group-hover:opacity-100 transition-opacity duration-300 backdrop-blur-[2px]">
                <i data-lucide="camera" class="w-8 h-8 text-white"></i>
            </label>
            
            <label for="file-upload" class="md:hidden absolute bottom-0 right-0 bg-black text-white p-2 rounded-full cursor-pointer hover:scale-110 transition border-4 border-white shadow-lg">
                <i data-lucide="camera" class="w-4 h-4"></i>
            </label>

            <input id="file-upload" type="file" accept="image/*" class="hidden" onchange="handleImageUpload(this)">
        </div>

        <div class="text-center md:text-left">
            <h2 id="user-name-display" class="text-2xl font-bold font-serif mb-1">Guest User</h2>
            <p class="text-gray-400 text-xs uppercase tracking-widest mb-4">Member since 2026</p>
            
            <div class="flex flex-col md:flex-row gap-4 items-center">
                <button onclick="document.getElementById('file-upload').click()" class="text-xs font-bold underline hover:text-gold transition cursor-pointer">
                    Change Profile Photo
                </button>
                <span class="hidden md:block text-gray-300">|</span>
                <button onclick="auth.logout()" class="text-xs font-bold text-red-500 hover:text-red-700 transition">
                    Log Out
                </button>
            </div>
        </div>
    </div>

        <div class="flex border-b border-gray-200 mb-6">
            <button onclick="switchTab('orders')" id="tab-orders" class="flex-1 pb-3 border-b-2 border-black font-bold">My Orders</button>
            <button onclick="switchTab('wishlist')" id="tab-wishlist" class="flex-1 pb-3 border-b-2 border-transparent text-gray-500 hover:text-black">Wishlist</button>
        </div>

        <div id="content-orders" class="space-y-4">
            </div>

        <div id="content-wishlist" class="hidden grid grid-cols-2 md:grid-cols-3 gap-4">
            </div>

    </main>

   <nav class="fixed bottom-0 md:bottom-8 w-full md:w-auto z-50 transition-all duration-500 md:left-1/2 md:-translate-x-1/2">
        <div class="bg-white/90 backdrop-blur-xl border-t md:border border-gray-200 md:border-white/20 pb-safe md:pb-0 md:rounded-full md:shadow-2xl shadow-black/10 px-2 md:px-8">
            <div class="flex justify-around md:justify-center items-center h-16 md:h-20 gap-1 md:gap-8">
                <a href="index.html" class="dock-item group flex flex-col items-center gap-1 text-gray-500 hover:text-black p-2 md:hover:-translate-y-2 transition-transform duration-300">
                    <div class="p-1 rounded-full group-hover:bg-gray-100 transition"><i data-lucide="home" class="w-5 h-5 md:w-6 md:h-6"></i></div>
                    <span class="text-[10px] font-medium md:hidden">Home</span>
                    <span class="hidden md:block absolute -top-10 bg-black text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition pointer-events-none">Home</span>
                </a>
                <a href="index.html" class="dock-item group flex flex-col items-center gap-1 text-gray-500 hover:text-black p-2 md:hover:-translate-y-2 transition-transform duration-300">
                    <div class="p-1 rounded-full group-hover:bg-gray-100 transition"><i data-lucide="search" class="w-5 h-5 md:w-6 md:h-6"></i></div>
                    <span class="text-[10px] font-medium md:hidden">Search</span>
                    <span class="hidden md:block absolute -top-10 bg-black text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition pointer-events-none">Search</span>
                </a>
                <div onclick="openCart()" class="dock-item group relative flex flex-col items-center gap-1 text-gray-500 hover:text-black cursor-pointer p-2 md:hover:-translate-y-2 transition-transform duration-300">
                    <div class="relative p-1 rounded-full group-hover:bg-gray-100 transition">
                        <i data-lucide="shopping-bag" class="w-5 h-5 md:w-6 md:h-6"></i>
                        <span class="cart-badge absolute -top-1 -right-2 bg-red-600 text-white text-[9px] w-3.5 h-3.5 flex items-center justify-center rounded-full hidden shadow-sm border border-white">0</span>
                    </div>
                    <span class="text-[10px] font-medium md:hidden">Cart</span>
                    <span class="hidden md:block absolute -top-10 bg-black text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition pointer-events-none">Cart</span>
                </div>
                <a href="account.html" class="dock-item group flex flex-col items-center gap-1 text-black p-2 md:hover:-translate-y-2 transition-transform duration-300">
                    <div id="dock-account-icon" class="p-1 rounded-full group-hover:bg-gray-100 transition"><i data-lucide="user" class="w-5 h-5 md:w-6 md:h-6"></i></div>
                    <span class="text-[10px] font-medium md:hidden">Account</span>
                    <span class="hidden md:block absolute -top-10 bg-black text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition pointer-events-none">Account</span>
                </a>
            </div>
        </div>
    </nav>

    <div id="cart-overlay" class="fixed inset-0 bg-black/50 z-[60] hidden"></div>
    <div id="cart-drawer" class="fixed top-0 right-0 h-full w-full md:w-96 bg-white z-[70] transform translate-x-full transition-transform duration-300 flex flex-col">
        <div class="p-4 border-b flex justify-between items-center">
            <h2 class="font-bold">Your Cart</h2>
            <button onclick="closeCart()"><i data-lucide="x"></i></button>
        </div>
        <div id="cart-items" class="flex-1 overflow-y-auto p-4"></div>
        <div class="p-4 border-t">
            <div class="flex justify-between font-bold text-lg mb-4"><span>Total</span><span id="cart-total">$0.00</span></div>
            <a href="checkout.html" class="block w-full bg-black text-white text-center py-3 rounded">Checkout</a>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        lucide.createIcons();

        // NEW: Auth Guard - Redirects to login if the user is a guest!
        if (!auth.getCurrentUser()) {
            window.location.replace('login.html');
        }
        
        // 1. Load Profile Pic
        const savedPic = userData.getProfilePic();
        if(savedPic) document.getElementById('profile-img-display').src = savedPic;

        // 2. Handle Image Upload
        // Handle Image Upload with Safety Check
        function handleImageUpload(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];

                // 1. Check File Size (Limit to 2MB for LocalStorage safety)
                const limit = 2 * 1024 * 1024; // 2MB
                if (file.size > limit) {
                    alert("File is too large! Please select an image under 2MB.");
                    return;
                }

                // 2. Read and Save
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Save base64 string to LocalStorage via app.js logic
                    userData.setProfilePic(e.target.result); 
                    
                    // Force refresh image immediately
                    document.getElementById('profile-img-display').src = e.target.result;
                }
                reader.readAsDataURL(file);
            }
        }

        // 3. Tab Switching
        function switchTab(tab) {
            const ordersBtn = document.getElementById('tab-orders');
            const wishlistBtn = document.getElementById('tab-wishlist');
            const ordersContent = document.getElementById('content-orders');
            const wishlistContent = document.getElementById('content-wishlist');

            if(tab === 'orders') {
                ordersBtn.classList.add('border-black', 'text-black');
                ordersBtn.classList.remove('border-transparent', 'text-gray-500');
                wishlistBtn.classList.remove('border-black', 'text-black');
                wishlistBtn.classList.add('border-transparent', 'text-gray-500');
                ordersContent.classList.remove('hidden');
                wishlistContent.classList.add('hidden');
            } else {
                wishlistBtn.classList.add('border-black', 'text-black');
                wishlistBtn.classList.remove('border-transparent', 'text-gray-500');
                ordersBtn.classList.remove('border-black', 'text-black');
                ordersBtn.classList.add('border-transparent', 'text-gray-500');
                wishlistContent.classList.remove('hidden');
                ordersContent.classList.add('hidden');
            }
        }

        // 4. Render Orders
        const orders = userData.getOrders();
        const ordersDiv = document.getElementById('content-orders');
        if(orders.length === 0) {
            ordersDiv.innerHTML = '<p class="text-gray-400 text-center py-10">No orders yet.</p>';
        } else {
            ordersDiv.innerHTML = orders.map(o => `
                <div class="border rounded-lg p-4 bg-white">
                    <div class="flex justify-between mb-2">
                        <span class="font-bold">${o.id}</span>
                        <span class="text-green-600 text-sm font-medium">${o.status}</span>
                    </div>
                    <p class="text-gray-500 text-sm mb-2">${o.date}</p>
                    <div class="flex gap-2 overflow-x-auto pb-2">
                        ${o.items.map(i => `<img src="${i.image}" class="w-12 h-12 rounded object-cover border">`).join('')}
                    </div>
                    <div class="mt-2 text-right font-bold">$${o.total.toFixed(2)}</div>
                </div>
            `).join('');
        }

        // 5. Render Wishlist
        const wishlistIds = userData.getWishlist();
        const wishlistDiv = document.getElementById('content-wishlist');
        const wishlistItems = products.filter(p => wishlistIds.includes(p.id));

        if(wishlistItems.length === 0) {
            wishlistDiv.innerHTML = '<div class="col-span-2 text-center text-gray-400 py-10">Your wishlist is empty.</div>';
        } else {
            wishlistDiv.innerHTML = wishlistItems.map(p => `
                <div class="bg-white p-3 rounded-lg border shadow-sm relative">
                    <button onclick="userData.toggleWishlist(${p.id}); window.location.reload()" class="absolute top-2 right-2 text-red-500"><i data-lucide="x-circle" class="w-5 h-5"></i></button>
                    <img src="${p.image}" class="w-full h-32 object-cover rounded mb-2">
                    <h4 class="font-bold text-sm truncate">${p.name}</h4>
                    <p class="text-sm">$${p.price}</p>
                    <button onclick="cartLogic.addItem(products.find(i=>i.id==${p.id}))" class="mt-2 w-full bg-black text-white text-xs py-2 rounded">Add to Cart</button>
                </div>
            `).join('');
            lucide.createIcons();
        }
    </script>
        <script>
    // 1. Disable Right-Click
    document.addEventListener('contextmenu', function(event) {
        event.preventDefault();
        // Optional: Alert the user
        // alert("Right-click is disabled on this site."); 
    });

    // 2. Disable Keyboard Shortcuts (F12, Ctrl+Shift+I, Ctrl+U, etc.)
    document.onkeydown = function(e) {
        // F12
        if (e.keyCode == 123) {
            return false;
        }

        // Ctrl + Shift + I (Inspect)
        if (e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) {
            return false;
        }

        // Ctrl + Shift + J (Console)
        if (e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) {
            return false;
        }

        // Ctrl + Shift + C (Element Selector)
        if (e.ctrlKey && e.shiftKey && e.keyCode == 'C'.charCodeAt(0)) {
            return false;
        }

        // Ctrl + U (View Source)
        if (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) {
            return false;
        }
        if (e.ctrlKey && e.keyCode == 'S'.charCodeAt(0)) {
            return false;
        }
    };
</script>
</body>
</html>

